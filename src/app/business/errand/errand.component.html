<app-crumbs [title]='crumbs.title' [subTitle]="crumbs.subTitle"></app-crumbs>

<section class="scrollable">
  <section class="panel panel-default">
    <div class="row wrapper">
      <div class="col-sm-5 m-b-xs flex-left">
        <div class="btn-group" data-toggle="buttons">
          <a routerLinkActive="active" routerLink="/app/errand/add" class="btn btn-sm btn-success">
            <i class="fa fa-plus fa-fw m-r-xs"></i>新建
          </a>
        </div>
      </div>
      <div class="col-sm-3"></div>
      <div class="col-sm-4">
        <div class="input-group">
          <input type="text" class="input-sm form-control" placeholder="请输入出差编号..." [(ngModel)]="formData.name"
                 (keyup.enter)="loadEntities()">
          <span class="input-group-btn">
                        <button class="btn btn-sm btn-default" type="button" (click)="loadEntities()">搜索</button>
                      </span>
        </div>
      </div>
    </div>
    <div class="table-responsive">
      <table class="table table-striped b-t b-light">
        <thead>
        <tr>
          <th *ngFor="let item of listHeader" [ngStyle]="{'width': item.width}">{{item.title}}</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let item of errands; let i = index">
          <td *ngFor="let head of listHeader">
            <span *ngIf="head.type == 'text'" ngClass="{{head.class}}"
                  [ngStyle]="{'width': item.width, 'cursor': item.cursor}">{{item[head.field]}}</span>
            <span *ngIf="head.type == 'click'" ngClass="{{head.class}}" (click)="details(item)"
                  [ngStyle]="{'width': item.width, 'cursor': 'pointer'}">{{item[head.field]}}</span>
            <span *ngIf="head.type == 'union'" ngClass="{{head.class}}"
                  [ngStyle]="{'width': item.width, cursor: 'pointer'}" (click)="clickFnFlow(item)">{{unionHead(item, head)}}</span>
            <span ngClass="{{head.class}}" [ngStyle]="{'width': item.width, 'cursor': 'pointer'}"
                  *ngIf="head.type === 'enum'" (click)="clickFnFlow(item)">
                  <p *ngFor="let obj of head.options">
                    {{obj.value == item[head.field] ? obj.name: ''}}
                  </p>
                </span>
            <div class="" *ngIf="head.field === 'option'">
              <a nz-button nz-popover nzContent="编辑" (click)="edit({id: item.id})" *ngIf="noProcess(item)"><i
                class="fa fa-edit text-success text-active"></i><i
                class="fa fa-edit text-success text"></i></a>

              <a nz-button nz-popover nzContent="删除" (click)="remove({id: item.id}, item.name)"
                 *ngIf="noProcess(item)"><i
                class="fa fa-trash-o text-danger-dk text-active"></i><i
                class="fa fa-trash-o text-danger-dk text"></i></a>

              <a nz-button nz-popover nzContent="提交申请" (click)="showModal(item.id)" *ngIf="!isProcessing(item)"><i
                class="fa fa-sitemap text-info-dk text-active"></i><i
                class="fa fa-sitemap text-info-dk text"></i></a>

              <a nz-button nz-popover nzContent="审核" (click)="showExamModal(item)" *ngIf="isProcessing(item)"><i
                class="fa fa-gavel text-info-dk text-active"></i><i
                class="fa fa-gavel text-info-dk text"></i></a>
            </div>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
    <footer class="panel-footer">
      <div class="row">
        <nz-pagination [(nzPageIndex)]="formData.pageNum" [nzTotal]="formData.totalNum"
                       (nzPageIndexChange)="loadEntities()"></nz-pagination>
      </div>
    </footer>
  </section>
</section>


<nz-modal [(nzVisible)]="isVisible" nzTitle="出差申请单详情" [nzWidth]="800" (nzOnCancel)="isVisible = false" *ngIf="selected"
          [nzFooter]="modalFooter">

  <!--startprint1-->
  <!--打印内容开始-->
  <div id="errand-panel" #print>
    <div class="elogo"><img src="assets/img/goshine.png" style="transform: scale(1.5);"></div>
    <nz-form-item style="margin: 0;">
      <div class="ant-col-17 ant-form-item-label ehead">
        <span style="font-size: 25px;">出差申请单</span>
      </div>
      <div class="ant-col-7 ant-form-item-label ehead">
        <span>ST-MT-01v1.0.1</span>
      </div>
    </nz-form-item>
    <nz-table #basicTable [nzData]="[{}, {}]" [nzShowPagination]="false" >
      <div class="ant-table-wrapper ant-table-empty">
        <div>
          <div class="ant-spin-container">
            <div>
              <div class="ant-table ant-table-bordered ant-table-large">
                <div class="ant-table-body">
                  <table>
                    <colgroup></colgroup>
                    <thead class="ant-table-thead"></thead>
                    <tbody _ngcontent-c13="" style="border: 1px solid black;" class="ant-table-tbody">
                    <tr *ngFor="let data of basicTable.data"></tr>
                    <tr _ngcontent-c13="" class="ant-table-row">
                      <td _ngcontent-c13="" colspan="2" class="ant-col-4 elabel">申请人</td>
                      <td _ngcontent-c13="" colspan="2" class="ant-col-4 evalue">{{selected.username}}</td>
                      <td _ngcontent-c13="" colspan="2" class="ant-col-4 elabel">所属部门</td>
                      <td _ngcontent-c13="" colspan="2" class="ant-col-4 evalue">{{selected.orgName}}</td>
                      <td _ngcontent-c13="" colspan="2" class="ant-col-4 elabel">申请日期</td>
                      <td _ngcontent-c13="" colspan="2" class="ant-col-4 evalue">{{selected.applyDate}}</td>
                    </tr>
                    <tr _ngcontent-c13="" class="ant-table-row">
                      <td _ngcontent-c13="" colspan="2" class="ant-col-4 elabel">差期
                      </td>
                      <td _ngcontent-c13="" colspan="10" class="ant-col-20" style="text-align: center;">
                        {{selected.dateRangeStart | date: 'yyyy 年 MM 月 dd 日 HH 时'}}
                        至
                        {{selected.dateRangeEnd | date: 'yyyy 年 MM 月 dd 日 HH 时'}}
                      </td>
                    </tr>
                    <tr class="ant-table-row">
                      <td colspan="2" rowspan="2" class="elabel">出差事由</td>
                      <td colspan="10" rowspan="2" style="padding: 0px;">
                        <nz-radio-group nzName="radiogroup" [(ngModel)]="selected.planType" disabled>
                          <label nz-radio [nzValue]="1">售前</label>
                          <label nz-radio [nzValue]="2">项目</label>
                          <label nz-radio [nzValue]="3">其他</label>
                        </nz-radio-group>
                        <div><span style="color: black; font-weight: bold;">目的和计划</span></div>
                        <textarea name="plan" placeholder="点击修改目的和计划..." style="width: 100%; border: 0;" disabled
                                  rows="3" nz-input [(ngModel)]="selected.plan"></textarea>
                      </td>
                    </tr>
                    <tr class="ant-table-row">

                    </tr>

                    <tr _ngcontent-c13="" class="ant-table-row">
                      <td _ngcontent-c13="" colspan="3" class="ant-col-6 elabel">目的地
                      </td>
                      <td _ngcontent-c13="" colspan="3" class="ant-col-6 evalue">{{selected.target}}
                      </td>
                      <td _ngcontent-c13="" colspan="3" class="ant-col-6 elabel">部门负责人意见
                      </td>
                      <td _ngcontent-c13="" colspan="3" class="ant-col-6 evalue">{{selected.directorComment}}
                      </td>
                    </tr>
                    <tr _ngcontent-c13="" class="ant-table-row">
                      <td _ngcontent-c13="" colspan="3" class="ant-col-6 elabel">分管领导意见
                      </td>
                      <td _ngcontent-c13="" colspan="3" class="ant-col-6 evalue">{{selected.leaderComment}}
                      </td>
                      <td _ngcontent-c13="" colspan="3" class="ant-col-6 elabel">运营管理部确认
                      </td>
                      <td _ngcontent-c13="" colspan="3" class="ant-col-6 evalue">{{selected.operatorComment}}
                      </td>
                    </tr>
                    <tr _ngcontent-c13="" class="ant-table-row">
                      <td _ngcontent-c13="" colspan="3" class="ant-col-6 elabel">人力资源部核准
                      </td>
                      <td _ngcontent-c13="" colspan="3" class="ant-col-6 evalue">{{selected.resourcesComment}}
                      </td>
                      <td _ngcontent-c13="" colspan="3" class="ant-col-6 elabel">总经理意见
                      </td>
                      <td _ngcontent-c13="" colspan="3" class="ant-col-6 evalue">{{selected.managerComment}}
                      </td>
                    </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </nz-table>
  </div>

  <!--打印内容结束-->
  <!--endprint1-->
  <!--测试范围打印是否生效-->
  <ng-template #modalFooter>
    <essence-ng2-print
      [mode]="'popup'"
      [popTitle]="'表格打印'"
      [btnText]="'打印'"
      [btnClass]="{'btn': true, 'btn-info': true}"
      [printHTML]="print"
      [printStyle]="printStyle"
      [printCSS]="printCSS"
      [showBtn]="printBtnBoolean"
      (click)="beforePrint()"
      (printComplete)="printComplete()">
    </essence-ng2-print>
    <button nz-button nzType="primary" (click)="handleOk()">确认</button>
  </ng-template>
</nz-modal>


